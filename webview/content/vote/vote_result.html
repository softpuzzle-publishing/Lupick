<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lupick</title>
    <link rel="stylesheet" href="../../resources/plugins/fontawesome-free/css/all.min.css">
    <link rel="stylesheet" href="../../resources/plugins/jquery-ui/jquery-ui.min.css">
    <link rel="stylesheet" href="../../resources/css/bootstrap.css">
    <link rel="stylesheet" href="../../resources/css/style.css">
    <!-- jQuery -->
    <script src="../../resources/plugins/jquery/jquery.min.js"></script>
    <!-- jQuery UI 1.11.4 -->
    <script src="../../resources/plugins/jquery-ui/jquery-ui.min.js"></script>
    <!-- Bootstrap 4 -->
    <script src="../../resources/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
</head>

<body>
    <div class="wrap vote-result">
        <div class="header">
            <div class="top d-flex justify-content-between">
                <div class="d-flex align-items-center">
                    <a href="javascript:void(0)" class="ic-back"></a>
                    <span class="font-18 bold">결제하기</span>
                </div>
                <button type="button" class="ic-list" data-toggle="modal" data-target="#ic-list"></button>
            </div>
            <div class="search">
                <p class="font-13">번호를 탭하면 닉네임, 득표수, 투표한 번호를 볼 수 있어요. </p>
                <div class="input-search">
                    <input type="text" class="form-control h-50" placeholder="닉네임 또는 번호를 검색하세요">
                    <button type="button" class="ic-search" data-toggle="modal" data-target="#modal-fail"></button>
                </div>
            </div>
        </div>
       
        <div class="vote-result-wrap">
            <div class="balls">
                <div class="bg-balls">
                    <canvas id="winning" width="100%" height="100%"></canvas>
                </div>
             
            </div>
           
        </div>
    </div>

<!-- 투표 리스트 -->
<div class="modal fade bd-example-modal-lg" id="ic-list" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg list">
        <div class="modal-content">
            <div class="modal-header">
                <p class="font-18 bold">투표결과 리스트 보기</p>
                <button type="button" class="ic-close" data-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="wrap">
                <table class="table table-bordered table-center">
                    <colgroup>
                        <col width="20%">
                        <col width="35%">
                        <col width="20%">
                        <col width="25%">
                    </colgroup>
                    <thead>
                        <tr>
                            <th scope="col">번호</th>
                            <th scope="col">닉네임</th>
                            <th scope="col">득표수</th>
                            <th scope="col">투표번호</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>루피커가될래요</td>
                            <td>7</td>
                            <td>828</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>다람쥐돌잉</td>
                            <td>5</td>
                            <td>12</td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>지렁지렁이</td>
                            <td>3</td>
                            <td>543</td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td>슈크림붕어빵</td>
                            <td>0</td>
                            <td>23</td>
                        </tr>
                        <tr>
                            <td>5</td>
                            <td>한라산호랑이</td>
                            <td>0</td>
                            <td>763</td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td>백두산순록</td>
                            <td>0</td>
                            <td>123</td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td>백두산순록</td>
                            <td>0</td>
                            <td>123</td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td>백두산순록</td>
                            <td>0</td>
                            <td>123</td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td>백두산순록</td>
                            <td>0</td>
                            <td>123</td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td>백두산순록</td>
                            <td>0</td>
                            <td>123</td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td>백두산순록</td>
                            <td>0</td>
                            <td>123</td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td>백두산순록</td>
                            <td>0</td>
                            <td>123</td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td>백두산순록</td>
                            <td>0</td>
                            <td>123</td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td>백두산순록</td>
                            <td>0</td>
                            <td>123</td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td>백두산순록</td>
                            <td>0</td>
                            <td>123</td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td>백두산순록</td>
                            <td>0</td>
                            <td>123</td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td>백두산순록</td>
                            <td>0</td>
                            <td>123</td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td>백두산순록</td>
                            <td>0</td>
                            <td>123</td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td>백두산순록</td>
                            <td>0</td>
                            <td>123</td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td>백두산순록</td>
                            <td>0</td>
                            <td>123</td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td>백두산순록</td>
                            <td>0</td>
                            <td>123</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<!-- 당첨o -->
<div class="modal fade bd-example-modal-lg" id="modal-success" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg success">
        <div class="modal-content">
            <div class="desc">
                <p class="number bold">102</p>
                <p class="nic-name font-13 bold">지리산다람쥐</p>
                <p class="font-13">득표수 :<span>57</span>표</p>
                <p class="font-13">투표한 번호 : <span>999</span></p>
            </div>
        </div>
        <p class="text font-14 bold">화면을 터치하여 닫기</p>
    </div>
</div>
<!-- 당첨x -->
<div class="modal fade bd-example-modal-lg" id="modal-fail" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg fail">
        <div class="modal-content">
            <div class="desc">
                <p class="number bold">102</p>
                <p class="nic-name font-13 bold">지리산다람쥐</p>
                <p class="font-13">득표수 :<span>57</span>표</p>
                <p class="font-13">투표한 번호 : <span>999</span></p>
            </div>
        </div>
        <p class="text font-14 bold">화면을 터치하여 닫기</p>
    </div>
</div>

    <script>
        $(document).ready(function () {
            $(window).on('load', function () {
                //bouncing balls
                if ($('#winning').length > 0) {
                    bouncVoteresult();
                }
            })

        })
        //투표하기 ball
        function bouncVoteresult() {
            var stage = document.getElementById('winning');
            var browserX = window.screenX;
            var browserY = window.screenY;
            var balls = [];
            var total = 12;
            var currentDrag = null;
            var mouseX = 0;
            var mouseY = 0;
            var stageWidth = $('.balls').width();
            var stageHeight = $('.balls').height();
            stage.width = stageWidth;
            stage.height = stageHeight;

            var IE = document.all ? true : false;
            if (!IE) document.addEventListener(Event.MOUSEMOVE, getMouseXY, false);
            document.onmousemove = getMouseXY;

            window.onresize = function (event) {
                stage.width = 5;
                stage.height = 5;
                stageWidth = $(document).width();
                stageHeight = $(document).height();
                stage.width = stageWidth;
                stage.height = stageHeight;
            }

            generate();

            var drawingCanvas = document.getElementById('winning');
            if (drawingCanvas.getContext) {
                var context = drawingCanvas.getContext('2d');
                setInterval(render, 20);
            }

            jQuery(document).ready(function () {
                $(document).mousedown(function (e) {
                    onMouseDown();
                });

                $(document).mouseup(function (e) {
                    onMouseUp();
                });
            });

            function onMouseDown() {
                var j = balls.length;
                while (--j > -1) {
                    var dx = mouseX - balls[j].x;
                    var dy = mouseY - balls[j].y;
                    var dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist < balls[j].size / 2) {
                        currentDrag = balls[j];
                        currentDrag.dragging = true;
                        return;
                    }
                }
            }

            function onMouseUp() {
                if (currentDrag != null) currentDrag.dragging = false;
            }

            function generate() {
                for (var i = 0; i < total; i++) {
                    var ball = {};
                    ball.color = genHex(i);
                    ball.bounce = 1;
                    ball.vx = Math.random() * 50 - 25;
                    ball.vy = Math.random() * 50 - 25;
                    ball.size = 50;
                    ball.x = Math.random() * stageWidth;
                    ball.y = Math.random() * stageHeight;
                    balls[balls.length] = ball;
                }
            }

            function genHex(i) {
                colors = new Array(12);
                colors[0] = "#ffff00";
                colors[1] = "#ffff00";
                colors[2] = "#ffff00";
                colors[3] = "#ffff00";
                colors[4] = "#ffff00";
                colors[5] = "#ffff00";
                colors[6] = "#ffff00";
                colors[7] = "#ffff00";
                colors[8] = "#ffff00";
                colors[9] = "#ffff00";
                colors[10] = "#ffff00";
                colors[11] = "#000000";
                return colors[i];
            }
            function render() {
                var isChange = (browserX != window.screenX || browserY != window.screenY);
                if (isChange) {
                    var diffX = browserX - window.screenX;
                    browserX = window.screenX;

                    var diffY = browserY - window.screenY;
                    browserY = window.screenY;
                }

                var j = balls.length;
                while (--j > -1) {
                    update(balls[j]);

                    if (isChange) {
                        balls[j].vx += (diffX * .05);
                        balls[j].vy += (diffY * .1);
                    }
                }

                draw();
            }

            function draw() {
                context.clearRect(0, 0, stageWidth, stageHeight);
                var i = balls.length;
                while (--i > -1) {
                    context.fillStyle = balls[i].color;
                    context.beginPath();
                    context.arc(balls[i].x, balls[i].y, balls[i].size, 0, Math.PI * 2, true);
                    context.closePath();
                    context.fill();
                }
            }

            function update(ball) {
                collisionCheck();

                var gravity = 1.3;
                var drag = .95;

                if (ball.dragging) {
                    ball.vx = ball.x - ball.ox;
                    ball.vy = ball.y - ball.oy;
                    ball.ox = ball.x;
                    ball.oy = ball.y;

                    ball.x = mouseX;
                    ball.y = mouseY;

                    if ((ball.x + ball.size) > stageWidth) {
                        ball.x = stageWidth - ball.size;
                    } else if ((ball.x - ball.size) < 0) {
                        ball.x = 0 + ball.size;
                    }

                    if ((ball.y + ball.size) > stageHeight) {
                        ball.y = stageHeight - ball.size;
                    } else if ((ball.y - ball.size) < 0) {
                        ball.y = 0 + ball.size;
                    }
                } else {
                    ball.x += ball.vx;
                    ball.y += ball.vy;

                    if ((ball.x + ball.size) > stageWidth) {
                        ball.x = stageWidth - ball.size;
                        ball.vx = -ball.vx * ball.bounce;
                    } else if ((ball.x - ball.size) < 0) {
                        ball.x = 0 + ball.size;
                        ball.vx = -ball.vx * ball.bounce;
                    }

                    if ((ball.y + ball.size) > stageHeight) {
                        ball.y = stageHeight - ball.size;
                        ball.vy = -ball.vy * ball.bounce;
                    } else if ((ball.y - ball.size) < 0) {
                        ball.y = 0 + ball.size;
                        ball.vy = -ball.vy * ball.bounce;
                    }

                    ball.vx = ball.vx * drag;
                    ball.vy = ball.vy * drag + gravity;
                }
            }

            function collisionCheck() {
                var spring = 0.8;

                for (var i = 0; i < (total - 1); ++i) {
                    var ball0 = balls[i];

                    for (var j = i + 1; j < total; ++j) {
                        var ball1 = balls[j];
                        var dx = ball1.x - ball0.x;
                        var dy = ball1.y - ball0.y;
                        var dist = Math.sqrt(dx * dx + dy * dy);
                        var minDist = ball0.size + ball1.size;

                        if (dist < minDist) {
                            var angle = Math.atan2(dy, dx);
                            var tx = ball0.x + dx / dist * minDist;
                            var ty = ball0.y + dy / dist * minDist;
                            var ax = (tx - ball1.x);
                            var ay = (ty - ball1.y);


                            ball0.x -= ax;
                            ball0.y -= ay;

                            ball1.x += ax;
                            ball1.y += ay;


                            ball0.vx -= (ax * spring);
                            ball0.vy -= (ay * spring);
                            ball1.vx += (ax * spring);
                            ball1.vy += (ay * spring);
                        }
                    }
                }
            }

            function getMouseXY(e) {
                if (IE) {
                    mouseX = event.clientX + document.body.scrollLeft
                    mouseY = event.clientY + document.body.scrollTop
                } else {
                    mouseX = e.pageX
                    mouseY = e.pageY
                }

                if (mouseX < 0) {
                    mouseX = 0;
                }
                if (mouseY < 0) {
                    mouseY = 0;
                }

                return true;
            }
        }
    </script>
    <script src="../../resources/js/common.js"></script>
</body>

</html>